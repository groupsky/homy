[agent]
  interval = "10s"
  round_interval = true
  collection_jitter = "0s"

[[outputs.influxdb]]
  urls = ["http://influxdb:8086"]
  database = "sensors"
  skip_database_creation = true
  timeout = "1s"
  username = "${INFLUX_OUTPUT_USER}"
  password = "${INFLUX_OUTPUT_USER_PASSWORD}"
  content_encoding = "gzip"

[[outputs.health]]
  service_address = "http://localhost:8080"
  read_timeout = "5s"
  write_timeout = "5s"
  namepass = ["internal_write"]
  tagpass = { output = ["influxdb"] }

[[outputs.health.compares]]
  field = "buffer_size"
  lt = 5000.0

[[outputs.health.contains]]
  field = "buffer_size"

[[inputs.modbus]]
  name = "water_pump"
  slave_id = 1
  timeout = "1s"
  controller = "file:///dev/ttyUSB1"
  baud_rate = 9600
  data_bits = 8
  parity = "E"
  stop_bits = 1
  transmission_mode = "RTU"
  # electric meter Noark Ex9EM 1P 1M 80A MO MT
  holding_registers = [
    { name="voltage",              byte_order="AB",   data_type="FIXED",  scale=0.1,   address=[0] },
    { name="current",              byte_order="AB",   data_type="UFIXED", scale=0.1,   address=[1] },
    { name="frequency",            byte_order="AB",   data_type="UFIXED", scale=0.1,   address=[2] },
    { name="active_power",         byte_order="AB",   data_type="FIXED",  scale=1.0,   address=[3] },
    { name="reactive_power",       byte_order="AB",   data_type="FIXED",  scale=1.0,   address=[4] },
    { name="apparent_power",       byte_order="AB",   data_type="FIXED",  scale=1.0,   address=[5] },
    { name="power_factor",         byte_order="AB",   data_type="UFIXED", scale=0.001, address=[6] },
    { name="total_active_power",   byte_order="ABCD", data_type="UFIXED", scale=0.01,  address=[8] },
    { name="total_reactive_power", byte_order="ABCD", data_type="UFIXED", scale=0.01,  address=[10] },
  ]

[[inputs.modbus]]
  name = "waste_pump"
  slave_id = 3
  timeout = "1s"
  controller = "file:///dev/ttyUSB1"
  baud_rate = 9600
  data_bits = 8
  parity = "E"
  stop_bits = 1
  transmission_mode = "RTU"
  # electric meter Noark Ex9EM 1P 1M 80A MO MT
  holding_registers = [
    { name="voltage",              byte_order="AB",   data_type="FIXED",  scale=0.1,   address=[0] },
    { name="current",              byte_order="AB",   data_type="UFIXED", scale=0.1,   address=[1] },
    { name="frequency",            byte_order="AB",   data_type="UFIXED", scale=0.1,   address=[2] },
    { name="active_power",         byte_order="AB",   data_type="FIXED",  scale=1.0,   address=[3] },
    { name="reactive_power",       byte_order="AB",   data_type="FIXED",  scale=1.0,   address=[4] },
    { name="apparent_power",       byte_order="AB",   data_type="FIXED",  scale=1.0,   address=[5] },
    { name="power_factor",         byte_order="AB",   data_type="UFIXED", scale=0.001, address=[6] },
    { name="total_active_power",   byte_order="ABCD", data_type="UFIXED", scale=0.01,  address=[8] },
    { name="total_reactive_power", byte_order="ABCD", data_type="UFIXED", scale=0.01,  address=[10] },
  ]

[[inputs.modbus]]
  name = "oven"
  slave_id = 4
  timeout = "1s"
  controller = "file:///dev/ttyUSB1"
  baud_rate = 9600
  data_bits = 8
  parity = "E"
  stop_bits = 1
  transmission_mode = "RTU"
  # electric meter Sinotype DDS519MR
  holding_registers = [
    { name="voltage",            byte_order="ABCD", data_type="FLOAT32-IEEE", address=[0] },
    { name="current",            byte_order="ABCD", data_type="FLOAT32-IEEE", address=[8] },
    { name="frequency",          byte_order="ABCD", data_type="FLOAT32-IEEE", address=[54] },
    { name="active_power",       byte_order="ABCD", data_type="FLOAT32-IEEE", address=[18] },
    { name="power_factor",       byte_order="ABCD", data_type="FLOAT32-IEEE", address=[42] },
    { name="total_active_power", byte_order="ABCD", data_type="FLOAT32-IEEE", address=[256] },
  ]

[[inputs.modbus]]
  name = "stove"
  slave_id = 5
  timeout = "1s"
  controller = "file:///dev/ttyUSB1"
  baud_rate = 9600
  data_bits = 8
  parity = "E"
  stop_bits = 1
  transmission_mode = "RTU"
  # electric meter Sinotype DDS519MR
  holding_registers = [
    { name="voltage",            byte_order="ABCD", data_type="FLOAT32-IEEE", address=[0] },
    { name="current",            byte_order="ABCD", data_type="FLOAT32-IEEE", address=[8] },
    { name="frequency",          byte_order="ABCD", data_type="FLOAT32-IEEE", address=[54] },
    { name="active_power",       byte_order="ABCD", data_type="FLOAT32-IEEE", address=[18] },
    { name="power_factor",       byte_order="ABCD", data_type="FLOAT32-IEEE", address=[42] },
    { name="total_active_power", byte_order="ABCD", data_type="FLOAT32-IEEE", address=[256] },
  ]

[[inputs.modbus]]
  name = "dishwasher"
  slave_id = 6
  timeout = "1s"
  controller = "file:///dev/ttyUSB1"
  baud_rate = 9600
  data_bits = 8
  parity = "E"
  stop_bits = 1
  transmission_mode = "RTU"
  # electric meter Sinotype DDS519MR
  holding_registers = [
    { name="voltage",            byte_order="ABCD", data_type="FLOAT32-IEEE", address=[0] },
    { name="current",            byte_order="ABCD", data_type="FLOAT32-IEEE", address=[8] },
    { name="frequency",          byte_order="ABCD", data_type="FLOAT32-IEEE", address=[54] },
    { name="active_power",       byte_order="ABCD", data_type="FLOAT32-IEEE", address=[18] },
    { name="power_factor",       byte_order="ABCD", data_type="FLOAT32-IEEE", address=[42] },
    { name="total_active_power", byte_order="ABCD", data_type="FLOAT32-IEEE", address=[256] },
  ]

[[inputs.modbus]]
  name = "kitchen"
  slave_id = 7
  timeout = "1s"
  controller = "file:///dev/ttyUSB1"
  baud_rate = 9600
  data_bits = 8
  parity = "E"
  stop_bits = 1
  transmission_mode = "RTU"
  # electric meter Sinotype DDS519MR
  holding_registers = [
    { name="voltage",            byte_order="ABCD", data_type="FLOAT32-IEEE", address=[0] },
    { name="current",            byte_order="ABCD", data_type="FLOAT32-IEEE", address=[8] },
    { name="frequency",          byte_order="ABCD", data_type="FLOAT32-IEEE", address=[54] },
    { name="active_power",       byte_order="ABCD", data_type="FLOAT32-IEEE", address=[18] },
    { name="power_factor",       byte_order="ABCD", data_type="FLOAT32-IEEE", address=[42] },
    { name="total_active_power", byte_order="ABCD", data_type="FLOAT32-IEEE", address=[256] },
  ]

[[inputs.modbus]]
  name = "laundry"
  slave_id = 8
  timeout = "1s"
  controller = "file:///dev/ttyUSB1"
  baud_rate = 9600
  data_bits = 8
  parity = "E"
  stop_bits = 1
  transmission_mode = "RTU"
  # electric meter Sinotype DDS519MR
  holding_registers = [
    { name="voltage",            byte_order="ABCD", data_type="FLOAT32-IEEE", address=[0] },
    { name="current",            byte_order="ABCD", data_type="FLOAT32-IEEE", address=[8] },
    { name="frequency",          byte_order="ABCD", data_type="FLOAT32-IEEE", address=[54] },
    { name="active_power",       byte_order="ABCD", data_type="FLOAT32-IEEE", address=[18] },
    { name="power_factor",       byte_order="ABCD", data_type="FLOAT32-IEEE", address=[42] },
    { name="total_active_power", byte_order="ABCD", data_type="FLOAT32-IEEE", address=[256] },
  ]

[[inputs.modbus]]
  name = "boiler"
  slave_id = 20
  timeout = "1s"
  controller = "file:///dev/ttyUSB1"
  baud_rate = 9600
  data_bits = 8
  parity = "E"
  stop_bits = 1
  transmission_mode = "RTU"
  # electric meter Sinotype DDS519MR
  holding_registers = [
    { name="voltage",            byte_order="ABCD", data_type="FLOAT32-IEEE", address=[0] },
    { name="current",            byte_order="ABCD", data_type="FLOAT32-IEEE", address=[8] },
    { name="frequency",          byte_order="ABCD", data_type="FLOAT32-IEEE", address=[54] },
    { name="active_power",       byte_order="ABCD", data_type="FLOAT32-IEEE", address=[18] },
    { name="power_factor",       byte_order="ABCD", data_type="FLOAT32-IEEE", address=[42] },
    { name="total_active_power", byte_order="ABCD", data_type="FLOAT32-IEEE", address=[256] },
  ]
